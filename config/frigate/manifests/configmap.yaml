# Frigate configuration
# NVR with motion detection for 3x 4K cameras

apiVersion: v1
kind: ConfigMap
metadata:
  name: frigate-config
  namespace: frigate
  labels:
    app.kubernetes.io/name: frigate
data:
  config.yml: |
    # Frigate NVR Configuration
    # https://docs.frigate.video/configuration/

    mqtt:
      enabled: false

    # Intel VAAPI hardware acceleration
    ffmpeg:
      hwaccel_args: preset-vaapi

    # Recording configuration
    record:
      enabled: true
      retain:
        days: 7
        mode: motion
      alerts:
        retain:
          days: 14
      detections:
        retain:
          days: 14

    # Snapshots on motion
    snapshots:
      enabled: true
      retain:
        default: 14

    # Camera definitions
    cameras:
      front:
        enabled: true
        detect:
          enabled: false
          width: 640
          height: 360
          fps: 12
        motion:
          # Disable contrast enhancement to avoid CPU-based gamma filter
          improve_contrast: false
        ffmpeg:
          inputs:
            - path: rtsp://admin:{FRIGATE_RTSP_PASSWORD}@192.168.1.20:554/ch1/main/av_stream
              roles:
                - record
            - path: rtsp://admin:{FRIGATE_RTSP_PASSWORD}@192.168.1.20:554/ch1/sub/av_stream
              roles:
                - detect

      gate:
        enabled: true
        detect:
          enabled: false
          width: 640
          height: 360
          fps: 12
        motion:
          improve_contrast: false
        ffmpeg:
          inputs:
            - path: rtsp://admin:{FRIGATE_RTSP_PASSWORD}@192.168.1.21:554/ch1/main/av_stream
              roles:
                - record
            - path: rtsp://admin:{FRIGATE_RTSP_PASSWORD}@192.168.1.21:554/ch1/sub/av_stream
              roles:
                - detect

      back:
        enabled: true
        detect:
          enabled: false
          width: 640
          height: 360
          fps: 12
        motion:
          improve_contrast: false
        ffmpeg:
          inputs:
            - path: rtsp://admin:{FRIGATE_RTSP_PASSWORD}@192.168.1.22:554/ch1/main/av_stream
              roles:
                - record
            - path: rtsp://admin:{FRIGATE_RTSP_PASSWORD}@192.168.1.22:554/ch1/sub/av_stream
              roles:
                - detect

    # go2rtc configuration for HD live streaming
    go2rtc:
      streams:
        front:
          - rtsp://admin:{FRIGATE_RTSP_PASSWORD}@192.168.1.20:554/ch1/main/av_stream
        gate:
          - rtsp://admin:{FRIGATE_RTSP_PASSWORD}@192.168.1.21:554/ch1/main/av_stream
        back:
          - rtsp://admin:{FRIGATE_RTSP_PASSWORD}@192.168.1.22:554/ch1/main/av_stream
