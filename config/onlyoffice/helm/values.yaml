# OnlyOffice Document Server Helm Chart Values
# https://github.com/ONLYOFFICE/Kubernetes-Docs

# Disable JWT - oCIS handles authentication
jwt:
  enabled: false

# Allow connections from private IPs (internal cluster)
connections:
  allowPrivateIPAddress: true
  allowMetaIPAddress: true
  # Database connection - CloudNativePG creates secret: onlyoffice-postgresql-app
  dbExistingSecret: "onlyoffice-postgresql-app"
  dbSecretKeyName: "password"
  dbHost: "onlyoffice-postgresql-rw"
  dbName: onlyoffice
  dbUser: onlyoffice
  # Use existing Redis from paperless-ngx (passwordless)
  redisHost: "redis.paperless-ngx.svc.cluster.local"
  redisNoPass: true

# Persistence for document server data
persistence:
  enabled: true
  storageClass: longhorn-ssd
  size: 10Gi

# Resource limits
resources:
  requests:
    cpu: 100m
    memory: 512Mi
  limits:
    cpu: 2000m
    memory: 2Gi

# Disable bundled PostgreSQL - we use CloudNativePG
postgresql:
  enabled: false

# Use bundled RabbitMQ (required for OnlyOffice)
rabbitmq:
  enabled: true

# Disable bundled Redis - we use existing one from paperless-ngx
redis:
  enabled: false

# Service configuration
service:
  type: ClusterIP
  port: 80

# No ingress - internal only, accessed via oCIS WOPI
ingress:
  enabled: false

# Probes - OnlyOffice takes a while to start
probes:
  startup:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    failureThreshold: 30
  readiness:
    enabled: true
    periodSeconds: 10
  liveness:
    enabled: true
    periodSeconds: 30

# Disable upgrade job for initial install (causes chicken-egg problem)
upgrade:
  job:
    enabled: false
