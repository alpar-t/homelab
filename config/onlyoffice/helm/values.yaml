# OnlyOffice Document Server Helm Chart Values
# https://github.com/ONLYOFFICE/Kubernetes-Docs

# ===================
# Use Community Edition (free, AGPL v3 license)
# ===================
# The helm chart defaults to Developer Edition which has a 30-day trial.
# Community Edition is free forever for up to 20 concurrent connections.
# See: https://www.onlyoffice.com/en/license-faq.aspx
image:
  repository: onlyoffice/documentserver
  tag: latest
  pullPolicy: IfNotPresent

# JWT disabled for WOPI mode - oCIS WOPI handles authentication via WOPI tokens
# Note: JWT and WOPI are different auth mechanisms:
# - JWT: Direct API access protection (e.g., Nextcloud integration)
# - WOPI: Token-based protocol where oCIS generates access tokens per document
jwt:
  enabled: false

# Enable WOPI support for oCIS integration
# This enables the /hosting/discovery endpoint
# WOPI provides security through time-limited access tokens generated by oCIS
wopi:
  enabled: true

# Allow connections from both internal (oCIS collaboration) and external (browser)
connections:
  allowPrivateIPAddress: true
  allowMetaIPAddress: true
  # Database connection - CloudNativePG creates secret: onlyoffice-postgresql-app
  dbExistingSecret: "onlyoffice-postgresql-app"
  dbSecretKeyName: "password"
  dbHost: "onlyoffice-postgresql-rw"
  dbName: onlyoffice
  dbUser: onlyoffice
  # Use existing Redis from paperless-ngx (passwordless)
  redisHost: "redis.paperless-ngx.svc.cluster.local"
  redisNoPass: true
  # External RabbitMQ connection (deployed via manifests/rabbitmq.yaml)
  amqpHost: "rabbitmq"
  amqpPort: "5672"
  amqpUser: "onlyoffice"
  amqpProto: "amqp"
  amqpExistingSecret: "rabbitmq"
  amqpSecretKeyName: "rabbitmq-password"

# Persistence for document server data
persistence:
  enabled: true
  storageClass: longhorn-ssd
  size: 10Gi

# Resource limits
resources:
  requests:
    cpu: 100m
    memory: 512Mi
  limits:
    cpu: 2000m
    memory: 2Gi

# Disable bundled PostgreSQL - we use CloudNativePG
postgresql:
  enabled: false

# Disable bundled RabbitMQ - we deploy it separately via manifests
# (Helm subcharts don't work well with ArgoCD multi-source applications)
rabbitmq:
  enabled: false

# Disable bundled Redis - we use existing one from paperless-ngx
redis:
  enabled: false

# Service configuration
service:
  type: ClusterIP
  port: 80

# Ingress disabled - handled by oauth2-proxy-onlyoffice for authentication
# See config/oauth2-proxy-onlyoffice/README.md
ingress:
  enabled: false

# Probes - OnlyOffice takes a while to start
probes:
  startup:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    failureThreshold: 30
  readiness:
    enabled: true
    periodSeconds: 10
  liveness:
    enabled: true
    periodSeconds: 30

# Disable upgrade job for initial install (causes chicken-egg problem)
upgrade:
  job:
    enabled: false

# Enable example component - provides /hosting/discovery WOPI endpoint
# Required for oCIS collaboration integration
example:
  enabled: true
