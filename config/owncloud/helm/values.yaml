# ownCloud Infinite Scale Helm Chart Values
# https://github.com/owncloud/ocis-charts
# 
# Pocket ID Integration: https://pocket-id.org/docs/client-examples/oCIS

# ===================
# External Access
# ===================
externalDomain: drive.newjoy.ro

# ===================
# Features
# ===================
features:
  # Keep externalUserManagement DISABLED - we use internal IDM for user storage
  # External OIDC (Pocket ID) is configured via the external-oidc.yaml manifest
  externalUserManagement:
    enabled: false
  
  # Email notifications via Stalwart
  emailNotifications:
    enabled: true
    smtp:
      host: stalwart.stalwart-mail.svc.cluster.local
      port: 25
      sender: "ownCloud <service@newjoy.ro>"
      authentication: none
      encryption: none
  
  # Apps integration (OnlyOffice)
  # Note: uri is the browser-facing URL (user's browser loads OnlyOffice iframe)
  # The oCIS collaboration service connects to OnlyOffice internally via WOPI
  appsIntegration:
    enabled: true
    wopiIntegration:
      officeSuites:
        - name: OnlyOffice
          product: OnlyOffice
          enabled: true
          uri: https://office.newjoy.ro
          insecure: false
          disableProof: false
          secureViewEnabled: false
          disableChat: false
          iconURI: https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/onlyoffice.svg
          ingress:
            enabled: false

# ===================
# Ingress Configuration
# ===================
ingress:
  enabled: true
  ingressClassName: nginx
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
  tls: []

# ===================
# Security Context
# ===================
securityContext:
  fsGroup: 1000
  fsGroupChangePolicy: Always
  runAsUser: 1000
  runAsGroup: 1000

# ===================
# Resource Limits
# ===================
# Default limits for all oCIS services
# Batch processing services get conservative CPU limits
# UI-facing services (proxy, frontend) get higher priority
resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 50m
    memory: 256Mi

# ===================
# Services Configuration
# ===================
services:
  # Storage users - main file storage
  storageusers:
    persistence:
      enabled: true
      chownInitContainer: true
      storageClassName: longhorn-hdd
      size: 3000Gi
    storageBackend:
      driver: ocis
  
  # Search service with Tika integration - batch indexing, can be slow
  search:
    persistence:
      enabled: true
      chownInitContainer: true
      storageClassName: longhorn-ssd
      size: 15Gi
    extractor:
      type: tika
      tika:
        url: http://tika.paperless-ngx.svc.cluster.local:9998
    resources:
      limits:
        cpu: 500m
        memory: 1Gi
      requests:
        cpu: 50m
        memory: 256Mi
  
  # Thumbnails service - batch generation, can be slow
  thumbnails:
    persistence:
      enabled: true
      chownInitContainer: true
      storageClassName: longhorn-ssd
      size: 30Gi
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 50m
        memory: 128Mi
  
  # Web frontend configuration
  web:
    persistence:
      enabled: false
    config:
      oidc:
        # Client ID from Pocket ID OIDC client
        # Create client in Pocket ID with callback URLs:
        #   https://drive.newjoy.ro/
        #   https://drive.newjoy.ro/oidc-callback.html
        #   https://drive.newjoy.ro/oidc-silent-redirect.html
        webClientID: b85f28eb-bf7d-4544-a311-eadcd5c09a2d
  
  # IDM (internal identity management) - stores users locally
  # Users are auto-provisioned from Pocket ID on first login
  idm:
    persistence:
      enabled: true
      chownInitContainer: true
      storageClassName: longhorn-ssd
      size: 1Gi
  
  # NATS for internal messaging
  nats:
    persistence:
      enabled: true
      chownInitContainer: true
      storageClassName: longhorn-ssd
      size: 1Gi
  
  # Proxy service - UI facing, needs to be snappy
  proxy:
    resources:
      limits:
        cpu: 1000m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
  
  # Frontend service - UI facing, needs to be snappy
  frontend:
    resources:
      limits:
        cpu: 1000m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
