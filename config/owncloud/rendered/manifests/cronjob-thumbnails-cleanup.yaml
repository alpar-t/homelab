---
# Source: ocis/templates/thumbnails/jobs.yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: thumbnails-cleanup
  namespace: owncloud
  labels:
    helm.sh/chart: ocis-0.7.0
    app.kubernetes.io/name: ocis
    app.kubernetes.io/instance: ocis
    app.kubernetes.io/version: "7.1.4"
    app.kubernetes.io/managed-by: Helm
  annotations:
    ignore-check.kube-linter.io/latest-tag: "using the stable tag on this busybox image is better than having an outdated image"
spec:
  schedule: "0 * * * *"
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3
  concurrencyPolicy: Forbid
  startingDeadlineSeconds: 600
  suspend: true
  jobTemplate:
    spec:
      parallelism: 1
      ttlSecondsAfterFinished: 86400
      template:
        metadata:
          labels:
            app: thumbnails-cleanup
            helm.sh/chart: ocis-0.7.0
            app.kubernetes.io/name: ocis
            app.kubernetes.io/instance: ocis
            app.kubernetes.io/version: "7.1.4"
            app.kubernetes.io/managed-by: Helm
        spec:
          restartPolicy: Never
          securityContext:
              fsGroup: 1000
              fsGroupChangePolicy: Always
          
          
          nodeSelector: 
            {}
          containers:
            - name: thumbnails-cleanup
              image: "busybox:stable"
              imagePullPolicy: IfNotPresent
              securityContext:
                runAsNonRoot: true
                runAsUser: 1000
                runAsGroup: 1000
                readOnlyRootFilesystem: true
              command: [ "/bin/sh", "/script/thumbnails-cleanup-script.sh" ]
              volumeMounts:
                - name: thumbnails-data
                  mountPath: /var/lib/ocis
                - name: script
                  mountPath: "/script"
                

              resources: 
                {}
          
          volumes:
            - name: thumbnails-data
              persistentVolumeClaim:
                claimName: thumbnails-data
            - name: script
              configMap:
                name: thumbnails-cleanup-script-configmap
                defaultMode: 0500
